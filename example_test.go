package chatglm_test

import (
	"fmt"

	"github.com/go-aie/chatglm"
)

func Example_generate() {
	// Run `make convert` to get the quantized GGML model.
	p := chatglm.New("./chatglm-ggml.bin")
	defer p.Delete()

	output := p.Generate("ä½ å¥½")
	fmt.Println(output)

	// Output:
	// ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹ ChatGLM-6Bï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚
}

func Example_streamGenerate() {
	// Run `make convert` to get the quantized GGML model.
	p := chatglm.New("./chatglm-ggml.bin")
	defer p.Delete()

	history := []*chatglm.Turn{{Question: "ä½ å¥½", Answer: "ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹ ChatGLM-6Bï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚"}}
	output := p.StreamGenerate(chatglm.BuildPrompt("æ™šä¸Šç¡ä¸ç€åº”è¯¥æ€ä¹ˆåŠ", history), chatglm.WithDoSample(false))
	for text := range output {
		fmt.Print(text)
		//fmt.Printf("%s|", text)
	}

	// Output:
	// æ™šä¸Šç¡ä¸ç€å¯èƒ½ä¼šè®©äººæ„Ÿåˆ°ç„¦è™‘å’Œä¸å®‰ï¼Œä½†ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½æœ‰ç”¨çš„å»ºè®®ï¼š
	//
	// 1. ä¿æŒæ”¾æ¾ï¼šå°è¯•è¿›è¡Œæ·±å‘¼å¸ã€æ¸è¿›æ€§è‚Œè‚‰æ¾å¼›æˆ–å†¥æƒ³ç­‰æ”¾æ¾æŠ€å·§ï¼Œå¸®åŠ©æ”¾æ¾èº«ä½“å’Œå¤´è„‘ã€‚
	//
	// 2. é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼šç”µå­è®¾å¤‡çš„è“å…‰å¯èƒ½ä¼šå½±å“ç¡çœ ï¼Œå› æ­¤å»ºè®®åœ¨ç¡å‰å‡ ä¸ªå°æ—¶åœæ­¢ä½¿ç”¨ç”µå­è®¾å¤‡ã€‚
	//
	// 3. åˆ›é€ ä¸€ä¸ªèˆ’é€‚çš„ç¡çœ ç¯å¢ƒï¼šä¿æŒæˆ¿é—´å®‰é™ã€å‡‰çˆ½ã€é»‘æš—å’Œèˆ’é€‚ï¼Œæœ‰åŠ©äºæ›´å®¹æ˜“å…¥ç¡ã€‚
	//
	// 4. é¿å…é¥®ç”¨å«å’–å•¡å› çš„é¥®æ–™ï¼šå’–å•¡å› å¯èƒ½ä¼šå½±å“ç¡çœ ï¼Œå› æ­¤å»ºè®®åœ¨ç¡å‰å‡ ä¸ªå°æ—¶é¿å…é¥®ç”¨å«å’–å•¡å› çš„é¥®æ–™ã€‚
	//
	// 5. è§„å¾‹ä½œæ¯ï¼šä¿æŒè§„å¾‹çš„ä½œæ¯ä¹ æƒ¯ï¼Œä¾‹å¦‚æ¯å¤©åœ¨ç›¸åŒçš„æ—¶é—´ä¸ŠåºŠç¡è§‰å’Œèµ·åºŠï¼Œæœ‰åŠ©äºèº«ä½“æ›´å®¹æ˜“åœ°é€‚åº”è§„å¾‹çš„ç¡çœ æ¨¡å¼ã€‚
	//
	// å¦‚æœè¿™äº›æ–¹æ³•ä¸èƒ½å¸®åŠ©å…¥ç¡ï¼Œå»ºè®®å’¨è¯¢åŒ»ç”Ÿæˆ–ç¡çœ ä¸“å®¶ï¼Œè·å–æ›´ä¸“ä¸šçš„å»ºè®®å’Œå¸®åŠ©ã€‚
}
